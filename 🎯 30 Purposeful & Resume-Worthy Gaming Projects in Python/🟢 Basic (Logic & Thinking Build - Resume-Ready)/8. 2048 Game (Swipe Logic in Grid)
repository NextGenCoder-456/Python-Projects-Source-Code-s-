import random

def init_board():
    board = [[0]*4 for _ in range(4)]
    add_tile(board)
    add_tile(board)
    return board

def add_tile(board):
    empty = [(r,c) for r in range(4) for c in range(4) if board[r][c] == 0]
    if empty:
        r, c = random.choice(empty)
        board[r][c] = 2

def compress(board):
    new = [[0]*4 for _ in range(4)]
    for i in range(4):
        pos = 0
        for j in range(4):
            if board[i][j] != 0:
                new[i][pos] = board[i][j]
                pos += 1
    return new

def merge(board):
    for i in range(4):
        for j in range(3):
            if board[i][j] == board[i][j+1] and board[i][j] != 0:
                board[i][j] *= 2
                board[i][j+1] = 0
    return board

def reverse(board):
    return [row[::-1] for row in board]

def transpose(board):
    return [list(row) for row in zip(*board)]

def move_left(board):
    board = compress(board)
    board = merge(board)
    board = compress(board)
    return board

def move(board, direction):
    if direction == "w":
        board = transpose(board)
        board = move_left(board)
        board = transpose(board)
    elif direction == "s":
        board = transpose(board)
        board = reverse(board)
        board = move_left(board)
        board = reverse(board)
        board = transpose(board)
    elif direction == "d":
        board = reverse(board)
        board = move_left(board)
        board = reverse(board)
    elif direction == "a":
        board = move_left(board)
    return board

def print_board(board):
    for row in board:
        print("\t".join(map(str, row)))
    print()

def main():
    board = init_board()
    while True:
        print_board(board)
        move_dir = input("Move (WASD): ").lower()
        if move_dir in ["w", "a", "s", "d"]:
            board = move(board, move_dir)
            add_tile(board)

main()
